<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infographic Lịch TTHC Công an phường Buôn Hồ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="max-w-6xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden p-4 md:p-8">
    <!-- Nội dung tĩnh như bạn đã cung cấp (giữ nguyên không thay đổi) -->
    <!-- Bỏ qua phần này ở đây vì bạn đã có đầy đủ -->

    <!-- Trợ lý tra cứu thủ tục hành chính -->
    <div class="mt-8 md:mt-10 bg-yellow-50 p-4 md:p-6 rounded-lg shadow-lg border border-yellow-200">
      <h2 class="text-xl md:text-2xl lg:text-3xl font-bold text-yellow-800 mb-3 md:mb-4 text-center">
        ✨ Trợ lý tra cứu thủ tục hành chính ✨
      </h2>
      <p class="text-base md:text-lg text-gray-700 mb-3 md:mb-4 text-center">
        Nhập câu hỏi của bạn về các thủ tục hành chính để nhận được thông tin hữu ích.
      </p>
      <div class="flex flex-col md:flex-row gap-3 md:gap-4 mb-3 md:mb-4">
        <input type="text" id="procedureQuery" placeholder="Ví dụ: Làm căn cước mất bao lâu?"
          class="flex-grow p-2 border border-yellow-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 text-sm md:text-base">
        <button id="lookupButton"
          class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 text-sm md:text-base">
          Tra cứu
        </button>
      </div>
      <div id="loadingIndicator" class="text-center text-yellow-700 text-sm md:text-base hidden">
        Đang tải...
      </div>
      <div id="llmResponse"
        class="mt-3 md:mt-4 p-3 bg-yellow-100 rounded-lg border border-yellow-300 text-gray-800 text-base md:text-lg min-h-[70px] flex items-center justify-center text-center">
        Kết quả tra cứu sẽ hiển thị ở đây.
      </div>
    </div>
  </div>

  <!-- Ngữ cảnh dạng JS -->
  <script>
    const infographicContext = `Bạn là trợ lý AI hỗ trợ tra cứu thủ tục hành chính tại Công an phường Buôn Hồ. Dưới đây là lịch làm việc và các lĩnh vực:

1. Thời gian làm việc:
- Thứ Hai đến Thứ Sáu (Cấp đổi/cấp lại GPLX: đến sáng Thứ Bảy)
- Sáng: 07h00 - 11h30 (11h00 - 11h30 xử lý hồ sơ)
- Chiều: 13h30 - 17h00 (16h30 - 17h00 xử lý hồ sơ)

2. Lĩnh vực ưu tiên:
- Định danh điện tử: sáng Thứ Hai
- Căn cước: chiều Thứ Hai, cả ngày Thứ Ba và Thứ Tư
- Cư trú: Thứ Hai, Ba, Tư
- Phương tiện giao thông: Thứ Hai - Thứ Sáu
- GPLX: Thứ Hai - sáng Thứ Bảy`;
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const lookupButton = document.getElementById('lookupButton');
      const procedureQueryInput = document.getElementById('procedureQuery');
      const llmResponseDiv = document.getElementById('llmResponse');
      const loadingIndicator = document.getElementById('loadingIndicator');

      lookupButton.addEventListener('click', async () => {
        const userQuery = procedureQueryInput.value.trim();
        if (!userQuery) {
          llmResponseDiv.textContent = 'Vui lòng nhập câu hỏi của bạn.';
          return;
        }

        loadingIndicator.classList.remove('hidden');
        llmResponseDiv.textContent = '';

        try {
          const prompt = `${infographicContext}\n\nCâu hỏi của người dùng: ${userQuery}`;

          const payload = {
            contents: [
              {
                role: "user",
                parts: [{ text: prompt }]
              }
            ]
          };

          // Proxy an toàn bằng Apps Script
          const response = await fetch("https://script.google.com/macros/s/AKfycbwB61SHtihqf92pRBG1iZYMe1Mo6TEZROgZybf-__5AaLqBm7FBlziWTyAGjJas2qj7/exec", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!response.ok) {
            const errorData = await response.json();
            llmResponseDiv.textContent = `Lỗi từ API: ${errorData.error ? errorData.error.message : response.statusText}`;
            return;
          }

          const result = await response.json();
          if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
            llmResponseDiv.textContent = result.candidates[0].content.parts[0].text;
          } else {
            llmResponseDiv.textContent = 'Không thể lấy được thông tin. Vui lòng thử lại sau.';
          }
        } catch (err) {
          console.error(err);
          llmResponseDiv.textContent = 'Đã xảy ra lỗi. Vui lòng thử lại sau.';
        } finally {
          loadingIndicator.classList.add('hidden');
        }
      });
    });
  </script>
</body>
</html>
